文档创建时间：2019.10.23

博客已经上线了，原始设想的两大功能也都完成了，所以上一个阶段的开发已经结束了。

但是整体来看，这个博客依然是非常简陋的，还需要持续完善。

这一期的目标是：1. 新增内容管理平台 2. 扩增2个数据源 3. 改善上一版本遗留的一些问题
    
总结一下这期任务就是一提升一新功能一扩源。

打算先做内容管理平台，内容管理平台任务

### 改善上一版本遗留的一些问题。

    1. 爬虫类的改进
       把现有的content中的爬虫与HTML解析分离。
       形成seed content parser 三个独立的模块，降低系统的耦合性，每个模块职能更加专一，整体代码更加可维护
       完成 2019.10.31  
    
    3. ETL层的新增
       将页面数据下载与解析过程分离，将各个模块解耦。
       工作分解
       1. 新建爬虫数据库 spider_warehouse
       2. 新建页面解析代码 spider_warehouse —> pyhub 
       线上数据库不变(新增一个status字段)。
       完成 2019.10.31
       
    3. 时间字段修改为时间戳
       提供更加准确的时间存储 datetime.datetime(2015, 4, 19, 12, 20)
       
    4. 显示成距离现在的时间
       完成 2019.11.03

    5. 爬虫日志的添加
       完成 2019.11.03
    
    6. 定时任务的添加
       完成 2019.11.04
    
    7. 渲染的问题，文章markdown渲染的效果不尽如人
       使用editor.md 作为渲染markdown的引擎。
       完成 2019.11.01
    
    8. Nginx配置ssl证书
       完成 2019.11.03
    
    9. 遇到一个坑，在登录后台，重定向失败，是Nginx没有配置端口：
       参见：https://stackoverflow.com/questions/41348714/flasknginxgunicorn-redirect-error
       完成 2019.11.03
    
    10. ETL日志添加
    
    
    11. 爬虫日志重复
        就是你第二次调用log的时候，根据getLogger(name)里的name获取同一个logger，而这个logger里已经有了第一次你添加的handler，
        第二次调用又添加了一个handler，所以，这个logger里有了两个同样的handler，以此类推，调用几次就会有几个handler。。
        https://blog.csdn.net/huilan_same/article/details/51858817
        
    12. 遇到一个坑supervisord.sock 默认在tmp目录，而此目录为缓存目录，Linux有可能将此目录下的内容清理，
        导致supervisord不正常，表现在无法查看应用状态，无法重新读取应用配置，使得supervisord处于失控状态
        
        因此需要对配置中的目录进行修正。
        利用ps -ef | grep supervisord杀进程，然后重启服务，记得杀掉gunnicorn进程。
        完成 2019.11.04
    
### 新增内容管理平台。

    功能描述 
    - 管理员登陆，权限验证等相关功能
    - 内容的增删改查等
    
    1. 登陆，权限认证
       完成 2019.10.24  
       由于没有开发用户注册及用户权限管理系统，所以控制账号是通过后台直接添加的，密码的哈希是通过flask shell 命令完成的
       开发坑记录： 路由与认证装饰器顺序搞反了，导致权限验证未能生效。正确的顺序应该是先路由，后验证。
       原理：装饰的顺序按靠近函数顺序执行，从内到外装饰，调用时由外而内，执行顺序和装饰顺序相反
   
    2. 内容资源列表，可以新增、修改、删除内容
       完成 2019.10.25
       坑记录：在删除完成后，直接查询数据库，返回最新的数据状态。 应该是redirect到当前页面
       
    3. 内容编辑页面及预览内容，修改完可以保存内容，格式Markdown  
       使用markdown.md这个插件作为编辑器。
       完成 2019.10.27
       
    4. 数据字段坑
       PostgreSQL Datetime 字段为timestamps
       在插入数据时， 应使用 datetime.datetime(2015, 4, 19, 12, 20)
       完成 2019.10.29
       
    5. 文章插入图片
       坑记录： 在进行文件写入时，写入的文件夹路径用的是pathlib生成的路径，需要确保路径的类型是str。
       完成 2019.10.29
        
### 扩增2个数据源

    1. https://blog.ansheng.me/
       完成 2019.10.29
    2. https://www.the5fire.com/
       完成 2019.11.05



   
   